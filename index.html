<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ•ãƒªãƒ¼ã‚¢ãƒ‰ãƒ¬ã‚¹</title>
    <link rel="stylesheet" href="style2.css">
    <script  src="./js/index.js"></script>
    <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>

</head>
<body>

    <h1>
        <p class="title">æœ¬æ—¥ã®åº§å¸­</p>
    </h1>

    <div class="step1">
    <button  class="btn_circle" id="btn_set">è‡ªåˆ†ã®ä½ç½®ã‚’ç™»éŒ²ã™ã‚‹</button>
    <button class="btn_circle" id="btn_check">ä»–ã®äººã®ä½ç½®ã‚’ç¢ºèªã™ã‚‹</button>
ã€€ã€€ </div>

    <div class="set">
    <button class="btn_rectangle" id="btn_geo" onclick="location.href='geolocation_string.html'">ç¤¾å¤–(ç¾åœ¨åœ°ã‚’èª­ã¿è¾¼ã‚€)</button>
    <button class="btn_rectangle" id="btn_qr">ç¤¾å†…</button>
ã€€ã€€</div>

<div class="syanai">
<th>åå‰ï¼š</th>
<input type="text" id="namae">
<div> ãƒ•ãƒ­ã‚¢ï¼š<input type="text" id="floor">éš </div>
<div> ãƒ–ãƒ­ãƒƒã‚¯ï¼š<input type="text" id="block">å´ </div>
<div> åˆ—ï¼š<input type="text" id="column">åˆ—ç›® </div>
<button class="btn_set" id="syanai_set">ç™»éŒ²</button>
</div>

  <!-- ç™»éŒ²ä½ç½®æƒ…å ±ã®è¡¨ç¤º -->
  <div class="kakunin">

  <table class="midashi_2">
    <p id="syagai">ç¤¾å†…</p>
    <tr>
      <th>ç™»éŒ²æ—¥</th>
      <th>åå‰</th>
      <th>ãƒ•ãƒ­ã‚¢(éš)</th>
      <th>ãƒ–ãƒ­ãƒƒã‚¯(å´)</th>
      <th>åˆ—</th>
    </tr>
  </table>
  <div id="output2"></div>

  <table class="midashi">
    <p id="syagai">ç¤¾å¤–</p>
    <tr>
      <th>ç™»éŒ²æ—¥</th>
      <th>åå‰</th>
      <th>ç·¯åº¦</th>
      <th>è»½åº¦</th>
    </tr>
  </table>
  <div id="output"></div>

  <div>

  </div>


</div>




<!-- Firebase -->
<script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.1.0/firebase-app.js";
    // è²¼ã‚Šä»˜ã‘ã‚‹å ´æ‰€
    import { getDatabase, ref, push,set, onChildAdded, remove, onChildRemoved , serverTimestamp} from "https://www.gstatic.com/firebasejs/9.1.0/firebase-database.js";
    //
    
    // TODO: Add SDKs for Firebase products that you want to use
    // https://firebase.google.com/docs/web/setup#available-libraries
    
    // Your web app's Firebase configuration
    const firebaseConfig = {

    };
    
    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const dbRef = ref(db, '05-js-kadai');
    const dbRef2 = ref(db, '05-js-kadai-2');
    const myTimestamp = serverTimestamp();
    
    // ç™»éŒ²
$('#syanai_set').on('click', function () {
  const namae = $('#namae').val();
  const floor = $('#floor').val();
  const block = $('#block').val();
  const column = $('#column').val();

  const syanai_data = {
  time: myTimestamp,
  namae: namae,
  floor: floor,
  block: block,
  column: column,
}

// firebaseã«é€ã‚‹æº–å‚™ã‚’ã—ã¦ã„ã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ğŸ¤—
const newPostRef = push(dbRef2) //ãƒ‡ãƒ¼ã‚¿ã‚’é€ä¿¡ã§ãã‚‹æº–å‚™
set(newPostRef, syanai_data); // firebaseã®ç™»éŒ²ã§ãã‚‹å ´æ‰€ã«ä¿å­˜ã™ã‚‹ã‚¤ãƒ¡ãƒ¼ã‚¸ã§ã™ğŸ¤—

});

    // å—ä¿¡å‡¦ç†ã‚’è¨˜è¿°
    $('#btn_check').on('click', function () {
    onChildAdded(dbRef, function (data) {
    // ã“ã“ã‹ã‚‰ãŒå—ä¿¡å‡¦ç†ãŒå§‹ã¾ã‚Šã¾ã™
    
    // ç™»éŒ²ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¾ã™ğŸ¤—
    const geo_data = data.val();
    console.log(geo_data, 'å–å¾—ã—ãŸãƒ‡ãƒ¼ã‚¿ã®å¡Š')
    const key = data.key;
    console.log(key, 'ãƒ‡ãƒ¼ã‚¿ã®å¡Šã«ã‚¢ã‚¯ã‚»ã‚¹')
    
    // es6ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒªãƒ†ãƒ©ãƒ«
    let h = `
        <tr>
          <th>${Date(geo_data.time).slice(4, 25)}</th>
          <td>${geo_data.uname}</td>
          <td>${geo_data.lat}</td>
          <td>${geo_data.lon}</td>
          <td><button class="sarch">åœ°å›³</button></td>
        </tr>
`
    // htmlã«åŸ‹ã‚è¾¼ã¿ã¾ã—ã‚‡ã†ğŸ¤—
    // append();ã¨ã„ã†jqueryã®ãŠã¾ã˜ãªã„ã‚’ä½¿ã„ã¾ã™
    $("#output").append(h);
    });
});

    // å—ä¿¡å‡¦ç†ã‚’è¨˜è¿°
    $('#btn_check').on('click', function () {
    onChildAdded(dbRef2, function (data) {
    // ã“ã“ã‹ã‚‰ãŒå—ä¿¡å‡¦ç†ãŒå§‹ã¾ã‚Šã¾ã™
    
    // ç™»éŒ²ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¾ã™ğŸ¤—
    const geo_data = data.val();
    console.log(geo_data, 'å–å¾—ã—ãŸãƒ‡ãƒ¼ã‚¿ã®å¡Š')
    const key = data.key;
    console.log(key, 'ãƒ‡ãƒ¼ã‚¿ã®å¡Šã«ã‚¢ã‚¯ã‚»ã‚¹')
    
    // es6ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒªãƒ†ãƒ©ãƒ«

ã€€ã€€ã€€ã€€let a = `
         <tr>
           <th>${Date(geo_data.time).slice(4, 25)}</th>
           <td>${geo_data.namae}</td>
           <td>${geo_data.floor}</td>
           <td>${geo_data.block}</td>
           <td>${geo_data.column}</td>
         </tr>`;

    // htmlã«åŸ‹ã‚è¾¼ã¿ã¾ã—ã‚‡ã†ğŸ¤—
    // append();ã¨ã„ã†jqueryã®ãŠã¾ã˜ãªã„ã‚’ä½¿ã„ã¾ã™
    $("#output2").append(a);
    });
});



    </script>


</body>
</html>